# agents/playwright_agent.py (V4 - With Grounding Constraint)
# ... (الاستيرادات والتهيئة كما في النسخة السابقة) ...

class PlaywrightAgent(BaseAgent):
    # ... (دوال أخرى كما هي) ...

    def _build_playwriting_prompt(self, blueprint: Dict, profiles: Dict, ...) -> str:
        # ... (نفس منطق بناء الـ prompt من النسخة السابقة) ...
        
        # --- [جديد] إضافة القيد السلبي كقاعدة أساسية ---
        grounding_rule = """
### قاعدة أساسية (مهم جدًا) ###
**ممنوع استخدام الترجمات الصوتية المباشرة** من لغات أخرى (مثل 'بيك'، 'بوس'، 'كول'). إذا احتجت للتعبير عن مفهوم له أصل أجنبي، استخدم دائمًا المقابل التونسي الأصيل والشائع (مثال: بدلاً من 'بوس'، استخدم 'المعلم' أو 'الباترون'). حافظ على أصالة اللغة.
"""

        # --- [تجميع الـ Prompt النهائي والمحسّن] ---
        base_prompt = f"""
مهمتك: أنت كاتب مسرحي تونسي محترف...
{grounding_rule}
### مخطط المشهد ###
...
"""
        return base_prompt
